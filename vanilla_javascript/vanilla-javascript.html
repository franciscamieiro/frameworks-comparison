<!doctype html>
<html lang="en" class="App">

<head>
  <meta charset="utf-8" />
  <title>Vanilla Balls Benchmark</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    code {
      font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
        monospace;
    }

    .App {
      width: 100%;
      box-sizing: border-box;
      background-color: #1e2229;
      /* match Svelte look */
      min-height: 100vh;
      color: white;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* Keep body container but align to top/left instead of centered */
    .App-body {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      padding: 20px;
      position: relative;
      z-index: 10;
      /* stay above the animated balls */
    }

    h1 {
      margin: 0 0 15px 0;
      font-size: 1.8rem;
      font-weight: 700;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }

    button {
      background: #f3f3f3;
      border: 1px solid #ccc;
      padding: 8px 16px;
      cursor: pointer;
      font-weight: 500;
      border-radius: 3px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    button:hover {
      background: #e9e9e9;
    }

    /* keep your small-screen layout adjustments */
    @media screen and (max-width: 650px) {
      .App-body {
        align-items: center;
      }

      .buttons {
        justify-content: center;
      }
    }

    .ball {
      position: absolute;
      will-change: transform;
    }
  </style>
</head>

<body class="App-body">
  <h1>Vanilla Balls Benchmark</h1>

  <div class="buttons">
    <button id="startBtn">Start Animation</button>
    <button data-count="50">50 Balls</button>
    <button data-count="100">100 Balls</button>
    <button data-count="500">500 Balls</button>
    <button data-count="1000">1000 Balls</button>
  </div>

  <div id="ballsContainer" class="balls-container"></div>

  <script>
    (function () {
      const duration = 10000; // ms
      let ballCount = 50;
      let balls = [];
      let animationId = null;
      let startTime = null;
      let frameCount = 0;

      const container = document.getElementById('ballsContainer');

      // Create ball elements and initial data
      function initBalls(count) {
        // clear previous
        cancelAnimationFrame(animationId);
        animationId = null;
        startTime = null;
        frameCount = 0;

        container.innerHTML = '';
        balls = [];

        const width = window.innerWidth;
        const height = window.innerHeight;

        for (let i = 0; i < count; i++) {
          const size = 15;
          const x = Math.random() * (width - size);
          const y = Math.random() * (height - size);
          const vx = (Math.random() - 0.5) * 8;
          const vy = (Math.random() - 0.5) * 8;
          const color = `hsl(${Math.random() * 360}, 70%, 50%)`;

          const el = document.createElement('div');
          el.className = 'ball';
          el.style.width = `${size}px`;
          el.style.height = `${size}px`;
          el.style.left = `${x}px`;
          el.style.top = `${y}px`;
          el.style.backgroundColor = color;
          container.appendChild(el);

          balls.push({ el, x, y, vx, vy, size });
        }
      }

      // Animation loop
      function animate(timestamp) {
        if (startTime === null) startTime = timestamp;
        frameCount++;

        const elapsed = timestamp - startTime;

        if (elapsed >= duration) {
          const totalTime = elapsed / 1000;
          const avgFrameTime = elapsed / frameCount;
          const fps = frameCount / totalTime;

          console.log(`Balls: ${balls.length}`);
          console.log(`Frames: ${frameCount}`);
          console.log(`Avg frame time: ${avgFrameTime.toFixed(2)} ms`);
          console.log(`FPS: ${fps.toFixed(2)}`);

          cancelAnimationFrame(animationId);
          animationId = null;
          return;
        }

        const width = window.innerWidth;
        const height = window.innerHeight;

        for (let i = 0; i < balls.length; i++) {
          const b = balls[i];

          let x = b.x + b.vx;
          let y = b.y + b.vy;
          let vx = b.vx;
          let vy = b.vy;

          const maxX = width - b.size;
          const maxY = height - b.size;

          if (x < 0) { x = 0; vx *= -1; }
          else if (x > maxX) { x = maxX; vx *= -1; }

          if (y < 0) { y = 0; vy *= -1; }
          else if (y > maxY) { y = maxY; vy *= -1; }

          b.x = x;
          b.y = y;
          b.vx = vx;
          b.vy = vy;

          b.el.style.left = `${x}px`;
          b.el.style.top = `${y}px`;
          b.el.style.width = `${b.size}px`;
          b.el.style.height = `${b.size}px`;
        }

        animationId = requestAnimationFrame(animate);
      }

      function startAnimation() {
        if (animationId) cancelAnimationFrame(animationId);
        startTime = null;
        frameCount = 0;
        initBalls(ballCount);
        animationId = requestAnimationFrame(animate);
      }

      // wire UI
      document.getElementById('startBtn').addEventListener('click', startAnimation);

      // init default
      initBalls(ballCount);
    })();
  </script>
</body>

</html>